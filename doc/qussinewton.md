# Quasi-Newton Methods
牛顿法在理论上和实践中均取得很好的效果．然而对于大规模问题，函数的海瑟矩阵计算代价特别大或者难以得到，即便得到海瑟矩阵我们还需要求解一个大规模线性方程组．那么能否使用海瑟矩阵或其逆矩阵的近似来进行牛顿迭代呢？拟牛顿法便是这样的算法，它能够在每一步以较小的计算代价生成近似矩阵，并且使用近似矩阵代替海瑟矩阵而产生的迭代序列仍具有超线性收敛的性质．  
拟牛顿方法不计算海瑟矩阵 $\nabla^2 f(x)$，而是构造其近似矩阵 $B^k$ 或其逆的近似矩阵 $H^k$ ．我们希望 $B^k$或$H^k$仍然保留海瑟矩阵的部分性质，例如使得 $d^k 仍然为下降方向．

# 割线法
连续二阶可微函数 $f(x)$ 的 梯度函数 $\nabla f(x)$， 在 $x^{k+1}$ 处， 泰勒展式为：
$$
\nabla f(x) = \nabla f(x^{k+1})^T  + \nabla^2 f(x^{k+1}) (x - x^{k+1}) + O(||x - x^{k+1}||^2)
$$
转换一下：
$$
\nabla^2 f(x^{k+1}) (x - x^{k+1}) + O(||x - x^{k+1}||^2) = \nabla f(x) - \nabla f(x^{k+1})^T (x - x^k)
$$
令 $x = x^k$ ， $s^k = x^{k+1} - x^k$，$ y^k = \nabla f(x^{k+1}) - \nabla f(x^k)^T$，则可以得到：
$$
\nabla^2 f(x^{k+1}) s^k + O(||s^k||^2) = y^kx
$$

忽略高阶项：
$$
\nabla^2 f(x^{k+1}) s^k \approx y^kx
$$

我们构造的$f(x)$的 Hessian矩阵的近似矩阵$B$, 和近似逆矩阵$H$，仍满足：  
$$
B^k s^k = y^kx \\

s^k = H^k y^k  \tag{1}
$$

方程（1） 也被成为割线方程。


另外一个角度看割线方程：  
牛顿法的本质是对 $f(x)$在 点$x^k$处二阶泰勒展开， 然后根据展开后的公式，固定 $f(x)$ 和 $\nabla f(x)$， 求解 $d^{k}$ ， 求使得 $f(x+ d^{k})$ 最小化的 $d^{k}$  
当我们用割线法，用 $B^k$近似代替 $ \nabla^2 f(x^{k+1})$ 后， 将整个步长函数$M(d)$ 在点$k+1$ 的二阶泰勒近似：
$$
M_{k+1}(d) = f(x^{k+1}) + \nabla f(x^{k+1})^T d^k + \frac{1}{2}(d^k)^T B^k d^k
$$
$$
\nabla M_{k+1}(d) = \nabla f(x^{k+1}) + B^k d^k
$$
我们要求 在 $M_{k+1}(d)$ 在 $d = -s^k$和 $d = 0$ 处的梯度，和 $f(x)$ 在 $x=x^k$和$x = x^{k+1}$处的梯度保持一致。
$$
\nabla M_{k+1}(-s^k) = M_{k+1}(-s^k) =  \nabla f(x^{k+1}) + B^k s^k  = \nabla f(x^k) \\
\nabla M_{k+1}(0) = \nabla f(x^k) 
$$
可以看出，$\nabla M_{k+1}(0)$ 必然满足，主要 $\nabla f(x^{k+1}) + B^k s^k  = \nabla f(x^k) $成立，即可满足要求。
可得：
$$
B^k s^k  = \nabla f(x^k) - \nabla f(x^{k+1})  = y^k
$$

## 算法框架
1. 给定初始点 $x_0$， $B^0$ 或者 $H^0$
2. 循环迭代：
3. 计算方向 $ d^k = -(B^k)^{-1} \nabla f(x^k)$ 或者 $d^k = -H^k \nabla f(x^k)$
4. 线搜索确定步长 $\alpha^k$
5. 更新 $x^{k+1} = x^k + \alpha^k d^k$
6. 更新 $B^{k+1}$ 或者 $H^{k+1}$
7. 判断是否收敛，如果 $||d^k|| < \epsilon$, 则停止迭代，否则返回 2


在实际应用中基于$H^{k}$的拟牛顿法因其无需求解线性方程组，更加实用。基于 $B^{k}$ 的方法稳定性更好，但计算量更大。

## 拟牛顿矩阵更新形式

### [秩一更新](https://zhuanlan.zhihu.com/p/144736223)

这个方法继承的思路是：我希望每一步对于$B^k$的更新能够尽可能的小。这个“尽可能小”得含义，其实就是
